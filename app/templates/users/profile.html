{% extends 'base.html' %}
{% block title %}{{ user.username }}'s Profile{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-100 py-8">

  <!-- Cover Image -->
  <div class="relative">
    <img src="{{ user.profile.cover_url or url_for('static', filename='default_cover.jpg') }}" alt="Cover Image" class="w-full h-64 object-cover rounded-b-lg shadow-md">

    <!-- Profile Picture -->
    <div class="absolute -bottom-12 left-10">
      <img src="{{ user.profile.photo_url or url_for('static', filename='default_avatar.png') }}" alt="Profile Picture" class="w-24 h-24 rounded-full border-4 border-white shadow-lg object-cover">
    </div>
  </div>

  <!-- Profile Info Card -->
  <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-md mt-16 p-6 text-center">
    <h1 class="text-3xl font-bold text-gray-800">{{ user.profile.first_name or '' }} {{ user.profile.last_name or user.username }}</h1>
    <p class="text-gray-600">{{ user.email }}</p>

    <div class="flex justify-center space-x-8 mt-4 text-gray-700">
      <div>
        <span class="font-semibold text-lg">{{ total_likes }}</span><br> Likes
      </div>
      <div>
        <span class="font-semibold text-lg">{{ followers_count }}</span><br> Followers
      </div>
      <div>
        <span class="font-semibold text-lg">{{ following_count }}</span><br> Following
      </div>
    </div>

    {% if current_user.is_authenticated and current_user.id != user.id %}
    <div class="flex justify-center space-x-4 mt-4">
      {% if current_user.is_following(user) %}
        <form action="{{ url_for('users.unfollow', user_id=user.id) }}" method="POST">
          <button type="submit" class="px-6 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300">Unfollow</button>
        </form>
      {% else %}
        <form action="{{ url_for('users.follow', user_id=user.id) }}" method="POST">
          <button type="submit" class="px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Follow</button>
        </form>
      {% endif %}
      <a href="{{ url_for('users.profile', user_id=user.id) }}" class="px-6 py-2 bg-green-500 text-white rounded hover:bg-green-600">Message</a>
    </div>
    {% endif %}

    {% if user.profile.about %}
      <div class="mt-6">
        <h2 class="text-xl font-semibold text-gray-800">About</h2>
        <p class="text-gray-700 mt-1">{{ user.profile.about }}</p>
      </div>
    {% endif %}

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
      {% if user.profile.interests %}
      <div>
        <h3 class="font-semibold text-gray-800">Interests</h3>
        <p class="text-gray-700 mt-1">{{ user.profile.interests }}</p>
      </div>
      {% endif %}
      {% if user.profile.primary_language %}
      <div>
        <h3 class="font-semibold text-gray-800">Primary Language</h3>
        <p class="text-gray-700 mt-1">{{ user.profile.primary_language }}</p>
      </div>
      {% endif %}
    </div>

    <div class="mt-6 text-sm text-gray-500">
      Joined on {{ user.created_at.strftime('%B %d, %Y') }}
    </div>
  </div>

  <!-- Tabs -->
  <div class="max-w-4xl mx-auto mt-8">
    <div class="flex justify-center space-x-8 bg-white rounded shadow-md p-4">
      <a href="{{ url_for('users.profile', user_id=user.id, tab='posts') }}" class="px-4 py-2 rounded {{ 'bg-blue-500 text-white' if tab == 'posts' else 'bg-gray-200' }}">Posts</a>
      <a href="{{ url_for('users.profile', user_id=user.id, tab='blogs') }}" class="px-4 py-2 rounded {{ 'bg-blue-500 text-white' if tab == 'blogs' else 'bg-gray-200' }}">Blogs</a>
      <a href="{{ url_for('users.profile', user_id=user.id, tab='pdfs') }}" class="px-4 py-2 rounded {{ 'bg-blue-500 text-white' if tab == 'pdfs' else 'bg-gray-200' }}">Library</a>
    </div>

    <div class="mt-6 bg-white rounded shadow-md p-6">

      {% if tab == 'posts' %}
        {% for post in items.items %}
          <div class="bg-white shadow rounded p-4 mb-3">
            <p class="mb-2">{{ post.body }}</p>
            <div class="flex justify-between text-sm text-gray-500">
              <span>{{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
              <span>‚ù§ {{ post.likes.count() }} ¬∑ üí¨ {{ post.comments.count() }}</span>
            </div>
            <a href="{{ url_for('posts.detail', post_id=post.id) }}" class="text-blue-600 text-sm mt-2 inline-block">View Post</a>
          </div>
        {% else %}
          <p class="text-gray-500">No posts yet.</p>
        {% endfor %}

      {% elif tab == 'blogs' %}
        {% for blog in items.items %}
          <div class="bg-white shadow rounded p-4 mb-3">
            <h2 class="text-lg font-bold mb-1">{{ blog.title }}</h2>
            <p class="text-gray-700">{{ blog.body[:200] }}{% if blog.body|length > 200 %}...{% endif %}</p>
            <div class="flex justify-between text-sm text-gray-500 mt-2">
              <span>{{ blog.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
              <span>‚ù§ {{ blog.likes.count() }} ¬∑ üí¨ {{ blog.comments.count() }}</span>
            </div>
            <a href="{{ url_for('blogs.detail', blog_id=blog.id) }}" class="text-blue-600 text-sm mt-2 inline-block">Read Blog</a>
          </div>
        {% else %}
          <p class="text-gray-500">No blogs yet.</p>
        {% endfor %}

      {% elif tab == 'pdfs' %}
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold">My Library</h2>
          {% if current_user.is_authenticated and current_user.id == user.id %}
            <a href="{{ url_for('library.upload_user_pdf') }}" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
              + Upload PDF
            </a>
          {% endif %}
        </div>

        <div class="space-y-4">
          {% for pdf in items.items %}
            <div class="bg-white shadow rounded p-4">
              <h2 class="text-lg font-bold">{{ pdf.title }}</h2>
              <p class="text-gray-700">{{ pdf.description }}</p>
              <p class="text-sm text-gray-500">Uploaded on {{ pdf.uploaded_at.strftime('%Y-%m-%d') }}</p>

              <a href="{{ url_for('library.download_pdf', kind='user', filename=pdf.filename) }}" class="text-blue-600 hover:underline">Download</a>

              {% if current_user.is_authenticated and (current_user.id == pdf.user_id or current_user.is_admin) %}
                <a href="{{ url_for('library.delete_pdf', kind='user', pdf_id=pdf.id) }}" class="text-red-600 ml-3 hover:underline">Delete</a>
              {% endif %}
            </div>
          {% else %}
            <p class="text-gray-500">No PDFs uploaded yet.</p>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Pagination -->
      <div class="mt-4">
        {% if items.has_prev %}
          <a href="{{ url_for('users.profile', user_id=user.id, tab=tab, page=items.prev_num) }}" class="px-3 py-1 bg-gray-300 rounded">Previous</a>
        {% endif %}
        {% if items.has_next %}
          <a href="{{ url_for('users.profile', user_id=user.id, tab=tab, page=items.next_num) }}" class="px-3 py-1 bg-gray-300 rounded">Next</a>
        {% endif %}
      </div>

    </div>
  </div>

</div>
{% endblock %}