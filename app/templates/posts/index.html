{% extends 'base.html' %}
{% block title %}Explore · Posts{% endblock %}
{% block content %}
<div class="flex justify-between items-center mb-4">
  <h1 class="text-xl font-semibold">Posts</h1>
  {% if current_user.is_authenticated %}
    <a href="{{ url_for('posts.create') }}" class="px-3 py-1 border rounded">New Post</a>
  {% endif %}
</div>

{% for post in posts.items %}
  <div class="border rounded-md p-3 mb-3 bg-white">
    <div class="flex justify-between items-start">
      <div>
        <div class="font-medium"><a href="{{ url_for('users.profile', user_id=post.user.id) }}">{{ post.user.profile.first_name or post.user.email }}</a></div>
        <div class="text-xs text-gray-500">{{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
      </div>
      <div class="text-sm">{{ post.likes.count() }} ❤️</div>
    </div>
    <p class="mt-3">{{ post.body }}</p>
    <div class="mt-3 flex gap-2">
      <a href="{{ url_for('posts.detail', post_id=post.id) }}" class="text-sm underline">View</a>
      {% if current_user.is_authenticated and (current_user.id==post.user_id or current_user.is_admin) %}
        <a href="{{ url_for('posts.edit', post_id=post.id) }}" class="text-sm underline">Edit</a>
        <form method="post" action="{{ url_for('posts.delete', post_id=post.id) }}" class="inline">
          <button class="text-sm underline">Delete</button>
        </form>
      {% endif %}
    </div>
  </div>
{% endfor %}

<div class="mt-4">
  {% if posts.has_prev %}<a href="{{ url_for('posts.index', page=posts.prev_num) }}" class="px-2">Prev</a>{% endif %}
  {% if posts.has_next %}<a href="{{ url_for('posts.index', page=posts.next_num) }}" class="px-2">Next</a>{% endif %}
</div>
{% endblock %}
